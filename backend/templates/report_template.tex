\documentclass[11pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{helvet}
\usepackage{graphicx}
\usepackage{xcolor}
\usepackage{geometry}
\usepackage{booktabs}
\usepackage{fancyhdr}
\usepackage{float}
\usepackage{titlesec}
\usepackage{colortbl}
\usepackage{hyperref}

% Colors
\definecolor{primary}{HTML}{2563EB}
\definecolor{secondary}{HTML}{64748B}
\definecolor{light}{HTML}{F8FAFC}
\definecolor{success}{HTML}{10B981}
\definecolor{danger}{HTML}{EF4444}

% Page Setup
\geometry{
    top=2.5cm,
    bottom=2.5cm,
    left=2cm,
    right=2cm
}

% Font
\renewcommand{\familydefault}{\sfdefault}

% Header/Footer
\pagestyle{fancy}
\fancyhf{}
\rhead{\textcolor{secondary}{\small Generated: \VAR{date}}}
\lhead{\textcolor{primary}{\textbf{VisionWealth}}}
\rfoot{\thepage}

% Title Format
\titleformat{\section}
{\color{primary}\Large\bfseries}
{\thesection}{1em}{}[\titlerule]

\titleformat{\subsection}
{\color{secondary}\large\bfseries}
{\thesubsection}{1em}{}

\begin{document}

% Title Page
\begin{titlepage}
    \centering
    \vspace*{2cm}
    
    {\Huge\bfseries\color{primary} PORTFOLIO ANALYSIS REPORT \par}
    \vspace{1cm}
    {\Large Prepared for: \VAR{client_name} \par}
    \vspace{2cm}
    
    % Summary Box
    \fcolorbox{gray!20}{light}{
        \begin{minipage}{0.8\textwidth}
            \centering
            \vspace{0.5cm}
            \begin{tabular}{lr}
                \textbf{\large Total Value} & {\large\color{primary}\textbf{\VAR{summary.total_value}}} \\[1em]
                \textbf{Total Gain/Loss} & \color{\VAR{summary.gain_loss_color}}\VAR{summary.total_gain_loss} \\
                \textbf{Total Return} & \color{\VAR{summary.gain_loss_color}}\VAR{summary.total_return_pct}\% \\
                \textbf{Holdings} & \VAR{summary.num_holdings} \\
            \end{tabular}
            \vspace{0.5cm}
        \end{minipage}
    }
    
    \vfill
    \includegraphics[width=0.8\textwidth]{\VAR{charts.allocation}}
    \vfill
    
    {\small Generated by VisionWealth Analytics Platform \par}
\end{titlepage}

\newpage

% Executive Summary
\section*{Executive Summary}
This report provides a comprehensive analysis of your investment portfolio as of \VAR{date}. Your portfolio consists of \textbf{\VAR{summary.num_holdings}} holdings with a total market value of \textbf{\VAR{summary.total_value}}.

The portfolio has generated a total return of \textbf{\VAR{summary.total_return_pct}\%} with an overall gain/loss of \textbf{\VAR{summary.total_gain_loss}}. The annual estimated income from dividends is \textbf{\VAR{summary.total_annual_income}}, representing an average yield of \textbf{\VAR{summary.avg_yield}\%}.


% Holdings Analysis
\section{Holdings Analysis}

\begin{table}[H]
    \centering
    \renewcommand{\arraystretch}{1.2}
    \begin{tabular}{llrrr}
        \toprule
        \textbf{Symbol} & \textbf{Description} & \textbf{Qty} & \textbf{Value} & \textbf{\%} \\
        \midrule
        \BLOCK{for holding in holdings[:15]}
        \textbf{\VAR{holding.Symbol}} & \VAR{holding.Description[:30]} & \VAR{holding.Quantity} & \VAR{holding.Value} & \VAR{holding.Assets} \\
        \BLOCK{endfor}
        \bottomrule
    \end{tabular}
    \caption{Top Portfolio Holdings (Sorted by Value)}
\end{table}

\vspace{1cm}

% Charts Section
\section{Portfolio Visualizations}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{\VAR{charts.allocation}}
    \caption{Asset Allocation by Symbol}
\end{figure}

\BLOCK{if charts.sector}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{\VAR{charts.sector}}
    \caption{Sector Allocation}
\end{figure}
\BLOCK{endif}

\newpage

% Risk Section using Blocks
\BLOCK{if analytics.risk_metrics}
\section{Risk Analysis}

\begin{itemize}
    \item \textbf{Value at Risk (95\%)}: \VAR{analytics.risk_metrics.value_at_risk_95}
    \item \textbf{Portfolio Volatility}: \VAR{analytics.risk_metrics.portfolio_volatility}\%
    \item \textbf{Diversification Score}: \VAR{analytics.diversification.score} / 100
\end{itemize}

\subsection*{Concentration Risk}
\VAR{analytics.diversification.concentration_risk}
\BLOCK{endif}

% Dividend Section
\BLOCK{if analytics.dividend_metrics}
\section{Dividend Analysis}
\textbf{Annual Income}: \VAR{analytics.dividend_metrics.total_annual_income} \\
\textbf{Average Yield}: \VAR{analytics.dividend_metrics.average_yield}\%

\subsection*{Top Dividend Payers}
\begin{itemize}
    \BLOCK{for payer in analytics.dividend_metrics.top_dividend_payers[:5]}
    \item \textbf{\VAR{payer.Symbol}}: \VAR{payer.Income} (\VAR{payer.Yield}\%)
    \BLOCK{endfor}
\end{itemize}
\BLOCK{endif}

\end{document}
